<!DOCTYPE html>
<html lang="en" style="height: 100%;">
<head>
    <meta charset="UTF-8">
    <title>Info Vis</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js" integrity="sha512-rKFvwjvE4liWPlFnvH4ZhRDfNZ9FOpdkD/BU5gAIA3VS3vOQrQ5BjKgbO3kxebKhHdHcNUHLqxQYSoxee9UwgA==" crossorigin="anonymous"></script>
    <script src="echarts.js"></script>
</head>
<body style="padding: 0; height: 100%;">
<div style="height: 100%; width: 100%;" id="graph">
</div>
</body>
<script>

var raw_data = {}
var links = []
let data = []


Papa.parse("/data/body_smoll.csv", {
    download: true,
    header: true,
    step: function (row){
        console.log(row);
        let source = row.data["SOURCE_SUBREDDIT"];
        let dest = row.data["TARGET_SUBREDDIT"];

        if(!(source in raw_data)){
            raw_data[source] = {
                id: source,
                name: source,
                value: 0,
                category: 'source',
                symbolSize: 0
            }
        }
        if(!(dest in raw_data)){
            raw_data[dest] = {
                id: dest,
                name: dest,
                value: 0,
                category: 'destination',
                symbolSize: 0
            }
        }

        raw_data[source].value++;
        raw_data[source].symbolSize++;

        raw_data[dest].value++;
        raw_data[dest].symbolSize++;

        links.push({
            source: source,
            target: dest
        })
    },
    complete: function () {
        console.log('CSV completely loaded')
        for(let node in raw_data){
            data.push(raw_data[node])
        }
        let options = {
            title: {
                text: "linking subreddits",
            },
            tooltip: {},
            animationDurationUpdate: 1500,
            animationEasingUpdate: 'quinticInOut',
            series: [{
                type: "graph",
                name: "subreddits",
                data: data,
                links: links,
                categories: ["source", "destination"],
                roam: true,
                layout: "force",
                force: {
                    repulsion: 1000
                },
                emphasis: {
                    focus: 'adjacency',
                    label: {
                        position: 'right',
                        show: true
                    }
                },
            }]
        }
        console.log(options);
        document.networkGraph = echarts.init(document.getElementById("graph"))
        document.networkGraph.setOption(options);
    }
})


let test_data = [
    {
        id: "1",
        name: "cats",
        value: 10,
        category: "cat",
        symbolSize: 5,
    },
    {
        id: "2",
        name: "cattaps",
        value: 5,
        category: "cat",
        symbolSize: 5,
    },
    {
        id: "3",
        name: "catswhoyell",
        value: 1,
        category: "cat",
        symbolSize: 5,
    }
]

let test_links = [
    {
        source: "1",
        target: "2"
    },
    {
        source: "1",
        target: "3"
    },
    {
        source: "2",
        target: "3"
    }
]


// let options = {
//     title: {
//         text: "linking subreddits",
//     },
//     tooltip: {},
//     series: [{
//         type: "graph",
//         name: "subreddits",
//         data: data,
//         links: links,
//         categories: ["source", "destination"],
//         roam: true,
//         layout: "force",
//         force: {
//             repulsion: 100
//         }
//     }]
// }
// console.log(options);
// document.networkGraph = echarts.init(document.getElementById("graph"))
// document.networkGraph.setOption(options);
</script>
</html>